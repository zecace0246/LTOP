<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ltop.app.menu5.mapper.M5Sub1Mapper">
  		
	<select id="selectUserList" resultType="com.ltop.app.menu5.domain.M5Sub1VO">
		SELECT	mem.userid AS userId
				, mem.username AS userName
				, mem.tel
				, mem.enabled
				, mem.mat_id AS matId
				, auth.auth
		FROM	tbl_member mem, tbl_member_auth auth  
		WHERE	mem.userid = auth.userid
				AND auth.auth = 'ROLE_USER'
				
				<if test="searchUserName != null and searchUserName != ''">
				AND mem.username = #{searchUserName}
				</if>
				
				<if test="searchMatId != null and searchMatId != ''">
				AND mem.mat_id = #{searchMatId}
				</if>
				
				<if test="searchEnabled != null and searchEnabled != ''">
				AND mem.enabled = #{searchEnabled}
				</if>				
	</select>	
	
	<select id="selectUserInfo" resultType="com.ltop.app.menu5.domain.M5Sub1VO">
		SELECT	mem.userid AS userId
				, mem.username AS userName
				, mem.tel
				, mem.enabled
				, mem.mat_id AS matId
				, auth.auth		
		FROM	tbl_member mem, tbl_member_auth auth  
		WHERE	mem.userid = auth.userid 
				AND mem.userid = #{userId}
	</select>	
	
	<insert id="insertUser">
		INSERT INTO tbl_member 
		(
			userid
			, userpw
			, username
			, regdate
			, updatedate
			, enabled
			, tel
			, mat_id
		)
		VALUES 
		(
			#{userId}
			, #{userPw}
			, #{userName}
			, NOW()
			, NOW()
			, #{enabled}
			, #{tel}
			, #{matId}
		)
	</insert>
		
	<update id="updateUser">
		UPDATE	tbl_member 
		SET		username = #{userName}
				, updatedate = NOW()
				, enabled = #{enabled}
				, tel = #{tel}
				, mat_id = #{matId}
		WHERE	userid = #{userId}	
	</update>
	
	<delete id="deleteUser">
		DELETE FROM tbl_member WHERE userid = #{userId}
	</delete>	

	<insert id="insertUserAuth">
		INSERT INTO tbl_member_auth 
		(
			userid
			, auth
		)
		VALUES 
		(
			#{userId}
			, #{auth}
		)
	</insert>
	
	<delete id="deleteUserAuth">
		DELETE FROM tbl_member_auth WHERE userid = #{userId}
	</delete>	

</mapper>
